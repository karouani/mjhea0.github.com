<div class="highlight"><pre>SELECT results.months,
       results.cohort,
       results.actives AS active_users,
       user_totals.total AS total_users,
       results.actives/user_totals.total*100 AS percent_active
FROM
  <span class="o">(</span> SELECT ROUND<span class="o">(</span>DATEDIFF<span class="o">(</span>events.date, users.date<span class="o">)</span>/30.4<span class="o">)</span> AS months,
           DATE_FORMAT<span class="o">(</span>events.date, <span class="s1">&#39;%Y/%m&#39;</span><span class="o">)</span> AS MONTH,
           DATE_FORMAT<span class="o">(</span>users.date, <span class="s1">&#39;%Y/%m&#39;</span><span class="o">)</span> AS cohort,
           COUNT<span class="o">(</span>DISTINCT users.id<span class="o">)</span> AS actives
   FROM users
   JOIN events ON events.user_id <span class="o">=</span> users.id
   GROUP BY cohort,
            months <span class="o">)</span> AS results
JOIN
  <span class="o">(</span> SELECT DATE_FORMAT<span class="o">(</span>date, <span class="s2">&quot;%Y/%m&quot;</span><span class="o">)</span> AS cohort,
           count<span class="o">(</span>id<span class="o">)</span> AS total
   FROM users
   GROUP BY cohort <span class="o">)</span> AS user_totals ON user_totals.cohort <span class="o">=</span> results.cohort
WHERE results.MONTH &lt; DATE_FORMAT<span class="o">(</span>NOW<span class="o">()</span>, <span class="s1">&#39;%Y/%m&#39;</span><span class="o">)</span>;

+--------+---------+--------------+-------------+----------------+
| months | cohort  | active_users | total_users | percent_active |
+--------+---------+--------------+-------------+----------------+
|      0 | 2013/02 |           29 |          48 |        60.4167 |
|      1 | 2013/02 |           35 |          48 |        72.9167 |
|      2 | 2013/02 |           38 |          48 |        79.1667 |
|      3 | 2013/02 |           40 |          48 |        83.3333 |
|      0 | 2013/03 |          156 |         338 |        46.1538 |
|      1 | 2013/03 |          251 |         338 |        74.2604 |
|      2 | 2013/03 |          258 |         338 |        76.3314 |
|      3 | 2013/03 |          305 |         338 |        90.2367 |
|      0 | 2013/04 |          888 |        1699 |        52.2660 |
|      1 | 2013/04 |         1290 |        1699 |        75.9270 |
|      0 | 2013/05 |         4454 |        7658 |        58.1614 |
|      1 | 2013/05 |         7004 |        7658 |        91.4599 |
|      2 | 2013/05 |         2157 |        7658 |        28.1666 |
|      0 | 2013/06 |        18612 |       24716 |        75.3034 |
+--------+---------+--------------+-------------+----------------+
</pre>
</div>
